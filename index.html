<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Perfil Maker (Fab Lab Rec)</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega a fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Define a fonte Inter como padrão */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo customizado para o card */
        .quiz-card {
            background-color: #1a1c31; /* Nova cor do card */
        }
        /* Esconde elementos para transição */
        .hidden-view {
            display: none;
        }
        /* Animação simples de loading */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ff3333;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-[#5f356d] text-gray-200 flex items-center justify-center min-h-screen p-4">

    <!-- Container Principal do Quiz -->
    <div class="quiz-card w-full max-w-2xl p-8 md:p-12 rounded-2xl shadow-2xl transition-all duration-300">

        <!-- 1. Visão do Quiz (Inicial) -->
        <div id="quiz-view">
            <!-- Cabeçalho -->
            <h1 class="text-3xl font-bold text-center mb-2">
                Qual seu <span class="text-[#ff3333]">Superpoder</span> na Escalada?
            </h1>
            <p class="text-center text-gray-400 mb-8">Baseado no Ciclo da Inovação (Sebrae / Fab Lab Rec)</p>

            <!-- Pergunta Atual -->
            <h2 id="question-text" class="text-2xl font-semibold mb-6 min-h-[50px]">
                Carregando pergunta...
            </h2>

            <!-- Botões de Resposta -->
            <div id="answer-buttons" class="space-y-4">
                <!-- Botões serão gerados pelo JavaScript -->
            </div>
        </div>

        <!-- 2. Visão de Resultado (Final) -->
        <div id="result-view" class="hidden-view text-center">
            <h1 id="result-title" class="text-3xl font-bold mb-3">
                <!-- Título do Resultado -->
            </h1>
            <p id="result-focus" class="text-xl font-semibold mb-6 text-[#a0cfc6]">
                <!-- Foco do Resultado -->
            </p>
            <p id="result-description" class="text-base mb-8">
                <!-- Descrição do Resultado -->
            </p>

            <!-- Botão ✨ API do Gemini ✨ -->
            <button id="gemini-challenge-button" class="w-full bg-[#f28020] hover:bg-opacity-80 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 mb-4 flex items-center justify-center space-x-2">
                <span>✨</span>
                <span>Me dê um desafio (Projeto de Vida)!</span>
            </button>

            <!-- Loading Spinner (Gemini) -->
            <div id="gemini-loading" class="hidden-view flex justify-center items-center space-x-2 my-4">
                <div class="loading-spinner"></div>
                <span class="text-gray-400">Pensando em um desafio...</span>
            </div>

            <!-- Resposta do Gemini -->
            <div id="gemini-response" class="mt-6 text-left p-4 bg-gray-800 rounded-lg hidden-view whitespace-pre-wrap"></div>


            <button id="restart-button" class="w-full bg-[#ff3333] hover:bg-opacity-80 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 mt-6">
                Fazer o Quiz Novamente
            </button>
        </div>
    </div>

    <!-- JavaScript - Lógica do Quiz -->
    <script>
        // --- 1. Dados do Quiz ---

        // Definição das Perguntas (NOVAS PERGUNTAS - TEMA "ESCALADA")
        const questions = [
            {
                question: "Vocês estão no 'City Tour Pedagógico' (Ato 2) visitando o Memorial JK. O que mais captura sua atenção?",
                answers: [
                    { text: "A história e o 'porquê' de JK. Suas motivações, o contexto, o legado. (Sentir/Observar)", profile: "inspiracao" },
                    { text: "A visão! A 'loucura' de imaginar e projetar uma capital inteira do zero. (Imaginar/Criar)", profile: "ideacao" },
                    { text: "A engenharia e arquitetura. Como os prédios foram *construídos*? Os materiais usados. (Construir)", profile: "prototipacao" },
                    { text: "O esforço coletivo. Como o projeto uniu 'Candangos' de todo o Brasil para *realizar* a obra. (Mobilizar)", profile: "compartilhamento" }
                ]
            },
            {
                question: "É hora da dinâmica 'Mapa dos Sonhos' (Ato 1: 'EU'). Qual é sua primeira ação ao pegar os materiais (revistas, canetas)?",
                answers: [
                    { text: "Paro e reflito. Quais são meus valores? O que *realmente* importa para mim antes de colar algo?", profile: "inspiracao" },
                    { text: "Começo a folhear tudo! Pego 20 imagens que me atraem, mesmo sem saber o porquê ainda.", profile: "ideacao" },
                    { text: "Começo a *organizar* a cartolina. Crio uma linha do tempo ou 'caixas' para estruturar o mapa.", profile: "prototipacao" },
                    { text: "Dou uma olhada no que os colegas (professores e alunos) estão fazendo para trocar ideias.", profile: "compartilhamento" }
                ]
            },
            {
                question: "Dia 3, 'Sprint de Prototipagem' no Sesi Lab. O desafio é criar algo para 'o futuro da sua comunidade'. Qual sua contribuição inicial?",
                answers: [
                    { text: "Calma, pessoal. Antes de construir, vamos definir: qual é o *problema real* que estamos resolvendo?", profile: "inspiracao" },
                    { text: "Tive uma ideia! E se a gente fizesse um app? Ou um robô? Ou um jardim vertical? Vamos listar tudo!", profile: "ideacao" },
                    { text: "Vou buscar a cortadora a laser e papelão. Vamos *fazer* um modelo físico rápido da ideia agora!", profile: "prototipacao" },
                    { text: "Vou organizar o time. Quem é bom em quê? Vamos definir papéis para todos entregarem o melhor.", profile: "compartilhamento" }
                ]
            },
            {
                question: "No seu grupo (com estudantes e professores), uma pessoa está quieta e não participa. Como você reage?",
                answers: [
                    { text: "Tento conversar com ela em particular, perguntando o que ela gosta de fazer. (Escuta Ativa)", profile: "inspiracao" },
                    { text: "Proponho uma rodada de 'ideias absurdas', onde não há certo ou errado, para quebrar o gelo.", profile: "ideacao" },
                    { text: "Entrego a ela uma tarefa 'mão na massa' simples (ex: cortar ou colar algo) para ela se sentir parte.", profile: "prototipacao" },
                    { text: "Crio um momento formal de rodada, convidando ela a falar: 'Fulano, o que você acha disso?'", profile: "compartilhamento" }
                ]
            },
            {
                question: "O tema da maratona é 'Design de Futuros'. O que mais te empolga nessa ideia?",
                answers: [
                    { text: "Analisar as tendências e *entender* os desafios (sociais, climáticos) que o futuro nos reserva.", profile: "inspiracao" },
                    { text: "A liberdade de *imaginar* futuros desejáveis e radicalmente diferentes do que temos hoje.", profile: "ideacao" },
                    { text: "O desafio de *planejar* os passos práticos e as ferramentas que precisamos *hoje* para chegar lá.", profile: "prototipacao" },
                    { text: "A chance de *construir* esse futuro coletivamente e *inspirar* outras pessoas a se juntarem a nós.", profile: "compartilhamento" }
                ]
            },
            // --- NOVAS PERGUNTAS ---
            {
                question: "A jornada tem 4 mentores (Design de Futuros, Maker, Inovação Social, Desenvolvimento Pessoal). De qual mentor você buscaria ajuda primeiro?",
                answers: [
                    { text: "Desenvolvimento Pessoal: para me ajudar a entender meus valores e emoções (Ato 1: 'EU').", profile: "inspiracao" },
                    { text: "Design de Futuros: para me ajudar a ter ideias disruptivas e 'sonhar grande'.", profile: "ideacao" },
                    { text: "Maker: para me ensinar a usar as ferramentas do Sesi Lab e tirar a ideia do papel.", profile: "prototipacao" },
                    { text: "Inovação Social: para me ajudar a conectar meu projeto com a comunidade e engajar pessoas.", profile: "compartilhamento" }
                ]
            },
            {
                question: "A narrativa da maratona é 'EU' -> 'EU E O OUTRO' -> 'EU E O MUNDO'. Qual etapa você acha mais essencial?",
                answers: [
                    { text: "O 'EU' (Ato 1). Tudo começa com o autoconhecimento; sem isso, nada faz sentido.", profile: "inspiracao" },
                    { text: "O 'MUNDO' (Ato 3). A parte de *imaginar* novos futuros é a mais poderosa para a mudança.", profile: "ideacao" },
                    { text: "O 'MUNDO' (Ato 3). A parte de *construir* e *fazer* é onde a mudança real acontece.", profile: "prototipacao" },
                    { text: "O 'OUTRO' (Ato 2). A conexão, a empatia e o senso de comunidade é o que move tudo.", profile: "compartilhamento" }
                ]
            },
            {
                question: "Você volta para casa após a 'Experiência Escalada'. Qual é sua *primeira* ação inspirada pela viagem?",
                answers: [
                    { text: "Escrever no meu 'Mapa dos Sonhos' tudo que observei, senti e aprendi sobre mim.", profile: "inspiracao" },
                    { text: "Pegar post-its e começar a desenhar 10 ideias novas para o meu 'Projeto de Vida'.", profile: "ideacao" },
                    { text: "Procurar materiais em casa (papelão, garrafa pet) para construir um protótipo de algo que vi no Sesi Lab.", profile: "prototipacao" },
                    { text: "Marcar uma conversa com amigos ou família para compartilhar o que vivi e como podemos agir juntos.", profile: "compartilhamento" }
                ]
            }
        ];

        // Definição dos Perfis de Resultado (Alinhados ao Ciclo da Inovação do doc)
        const resultsData = {
            inspiracao: {
                title: "O Explorador Empático",
                focus: "Foco em Sentir e Observar",
                description: "Você é a base do projeto! Seu superpoder é a curiosidade e a escuta ativa. Você adora investigar os 'porquês', entender as pessoas e definir o problema real antes de agir. (Alinhado ao Ato 1: 'EU')",
                colorClass: "text-[#a0cfc6]" // Light Teal
            },
            ideacao: {
                title: "O Visionário Criativo",
                focus: "Foco em Imaginar e Criar",
                description: "Você é a chama da inovação! Seu superpoder é 'imaginar futuros desejáveis'. Você pensa fora da caixa, gera múltiplas alternativas e não tem medo de ideias radicais. (Alinhado ao 'Design de Futuros')",
                colorClass: "text-[#f28020]" // Orange
            },
            prototipacao: {
                title: "O Construtor Mão na Massa",
                focus: "Foco em Construir e Prototipar",
                description: "Você é o motor da realização! Seu superpoder é transformar ideias em ação. Você adora 'aprender fazendo', testar materiais e usar ferramentas (como no Sesi Lab) para tornar o futuro palpável. (Alinhado ao Ato 3: 'EU E O MUNDO')",
                colorClass: "text-[#90851c]" // Olive Green
            },
            compartilhamento: {
                title: "O Conector Colaborativo",
                focus: "Foco em Compartilhar e Mobilizar",
                description: "Você é a voz do time! Seu superpoder é a empatia e o 'protagonismo juvenil'. Você une o grupo, garante que todos sejam ouvidos e sabe como comunicar uma ideia para engajar a comunidade. (Alinhao ao Ato 2: 'EU E O OUTRO')",
                colorClass: "text-[#ff3333]" // Bright Red
            }
        };
 
        // --- 2.2. Lógica Principal do Quiz ---

        // Referências aos elementos do HTML
        const quizView = document.getElementById('quiz-view');
        const resultView = document.getElementById('result-view');
        const questionText = document.getElementById('question-text');
        const answerButtons = document.getElementById('answer-buttons');

        const resultTitle = document.getElementById('result-title');
        const resultFocus = document.getElementById('result-focus');
        const resultDescription = document.getElementById('result-description');
        const restartButton = document.getElementById('restart-button');

        // Referências aos novos elementos do Gemini
        const geminiChallengeButton = document.getElementById('gemini-challenge-button');
        const geminiLoading = document.getElementById('gemini-loading');
        const geminiResponse = document.getElementById('gemini-response');

        // Variáveis de estado do Quiz
        let currentQuestionIndex = 0;
        let scores = {
            inspiracao: 0,
            ideacao: 0,
            prototipacao: 0,
            compartilhamento: 0
        };
        let currentProfileKey = ''; // Armazena o perfil atual para a chamada da API

        // Função para iniciar ou reiniciar o quiz
        function startQuiz() {
            currentQuestionIndex = 0;
            scores = { inspiracao: 0, ideacao: 0, prototipacao: 0, compartilhamento: 0 };
            currentProfileKey = '';
            
            // Garante que a visão de resultado esteja escondida e a de quiz visível
            resultView.classList.add('hidden-view');
            quizView.classList.remove('hidden-view');

            // Esconde os elementos do Gemini
            geminiResponse.classList.add('hidden-view');
            geminiLoading.classList.add('hidden-view');
            geminiResponse.innerText = '';
            
            showQuestion();
        }

        // Função para mostrar a pergunta atual
        function showQuestion() {
            // Limpa botões antigos
            answerButtons.innerHTML = '';
            
            // Pega a pergunta atual
            const question = questions[currentQuestionIndex];
            questionText.innerHTML = question.question;

            // Cria os botões de resposta
            question.answers.forEach(answer => {
                const button = document.createElement('button');
                button.innerHTML = answer.text;
                button.classList.add(
                    'w-full', 'bg-gray-700', 'hover:bg-[#ff3333]', 'text-white', 
                    'font-medium', 'py-3', 'px-5', 'rounded-lg', 'transition-colors', 
                    'duration-200', 'text-left'
                );
                
                // Adiciona o evento de clique
                button.addEventListener('click', () => selectAnswer(answer.profile));
                answerButtons.appendChild(button);
            });
        }

        // Função chamada ao selecionar uma resposta
        function selectAnswer(profile) {
            scores[profile]++;
            currentQuestionIndex++;

            // Verifica se o quiz terminou
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                showResult();
            }
        }

        // Função para calcular e mostrar o resultado
        function showResult() {
            // Encontra o perfil com maior pontuação
            let maxScore = -1;
            let resultProfile = '';

            for (const profile in scores) {
                if (scores[profile] > maxScore) {
                    maxScore = scores[profile];
                    resultProfile = profile;
                }
            }

            // Armazena o perfil para a API
            currentProfileKey = resultProfile;

            // Pega os dados do perfil vencedor
            const result = resultsData[resultProfile];

            // Atualiza o HTML da visão de resultado
            resultTitle.innerText = result.title;
            resultFocus.innerText = result.focus;
            resultDescription.innerText = result.description;
            
            // Remove classes de cor antigas e adiciona a nova
            resultFocus.className = 'text-xl font-semibold mb-6'; // Reseta
            resultFocus.classList.add(result.colorClass);

            // Esconde o quiz e mostra o resultado
            quizView.classList.add('hidden-view');
            resultView.classList.remove('hidden-view');
        }

        // --- 3. Lógica da API do Gemini ---

        // Função para chamar a API do Gemini com exponential backoff
        async function fetchWithBackoff(url, options, retries = 3, delay = 1000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    if (response.status === 429 && retries > 0) {
                        // Throttling, retry with backoff
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithBackoff(url, options, retries - 1, delay * 2);
                    }
                    throw new Error(`Erro na API: ${response.statusText}`);
                }
                return response.json();
            } catch (error) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchWithBackoff(url, options, retries - 1, delay * 2);
                }
                throw error;
            }
        }

        // Lida com o clique no botão de desafio
        async function handleGeminiChallengeClick() {
            if (!currentProfileKey) return; // Não deve acontecer

            // Mostra o loading, esconde resposta anterior
            geminiLoading.classList.remove('hidden-view');
            geminiResponse.classList.add('hidden-view');
            geminiResponse.innerText = '';
            geminiChallengeButton.disabled = true; // Desabilita o botão

            const profile = resultsData[currentProfileKey];
            
            // Definições da API
            const apiKey = ""; // A Chave da API será injetada pelo ambiente
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            // Prompt do Sistema: Define o "personagem" da IA (Contexto da Maratona Sebrae)
            const systemPrompt = "Você é um mentor experiente da 'Experiência Escalada' do Sebrae. Sua missão é apoiar o 'Projeto de Vida' de estudantes e professores. Use uma linguagem inspiradora, encorajadora e focada em empreendedorismo e ação. Responda em português do Brasil.";
            
            // Prompt do Usuário: O pedido específico (Contexto da Maratona Sebrae)
            const userQuery = `Meu perfil na maratona é "${profile.title}" (foco em ${profile.focus}). Me dê um micro-desafio (1 hora) alinhado ao meu 'Projeto de Vida' e ao meu perfil. O desafio deve ser algo que eu possa começar a planejar ou fazer agora, com os recursos que tenho (papel, caneta, celular). Formate a resposta de forma clara.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const result = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    geminiResponse.innerText = text;
                    geminiResponse.classList.remove('hidden-view');
                } else {
                    throw new Error("Resposta da API inválida.");
                }

            } catch (error) {
                console.error(error);
                geminiResponse.innerText = "Desculpe, não consegui pensar em um desafio agora. Tente novamente em alguns instantes.";
                geminiResponse.classList.remove('hidden-view');
            } finally {
                // Esconde o loading e reabilita o botão
                geminiLoading.classList.add('hidden-view');
                geminiChallengeButton.disabled = false;
            }
        }


        // --- 4. Inicialização ---

        // Adiciona o evento de clique no botão de reiniciar
        restartButton.addEventListener('click', startQuiz);

        // Adiciona o evento de clique no botão do Gemini
        geminiChallengeButton.addEventListener('click', handleGeminiChallengeClick);

        // Inicia o quiz assim que a página carrega
        document.addEventListener('DOMContentLoaded', startQuiz);

    </script>
</body>
</html>
