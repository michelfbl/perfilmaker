<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Perfil Maker (Fab Lab Rec)</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega as novas fontes (Baloo 2 para títulos, Sarabun para corpo) -->
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=Sarabun:wght@400&display=swap" rel="stylesheet">
    <style>
        /* Define as novas fontes */
        body {
            font-family: 'Sarabun', sans-serif; /* Fonte do corpo */
        }
        .font-title {
            font-family: 'Baloo 2', sans-serif; /* Fonte do título */
        }
        /* Estilo customizado para o card */
        .quiz-card {
            background-color: #ffffff; /* Fundo do card branco */
        }
        /* Esconde elementos para transição */
        .hidden-view {
            display: none;
        }
        /* Estiliza o input de arquivo */
        input[type="file"] {
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="bg-[#5f356d] flex items-center justify-center min-h-screen p-4">

    <!-- Container Principal do Quiz -->
    <div class="quiz-card w-full max-w-2xl p-8 md:p-12 rounded-2xl shadow-2xl transition-all duration-300 text-gray-900">

        <!-- 0. Visão de Início (NOVA) -->
        <div id="start-view">
            <img id="logo-start" src="https://placehold.co/200x60/5f356d/ffffff?text=FAB+LAB+LOGO&font=inter" alt="Logo Fab Lab" class="mx-auto mb-8 h-12">
            <h1 class="font-title text-3xl font-bold text-center mb-4">
                Quiz: Perfil Maker
            </h1>
            <p class="text-center text-gray-700 mb-8">Descubra seu superpoder no Ciclo da Inovação!</p>
            <div class="space-y-4">
                <button id="start-quiz-button" class="w-full bg-[#ff3333] hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 font-title text-lg">
                    Começar o Quiz!
                </button>
                <button id="config-button" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                    Configurar Imagens
                </button>
            </div>
        </div>

        <!-- 1. Visão de Configuração (NOVA) -->
        <div id="config-view" class="hidden-view">
            <h1 class="font-title text-3xl font-bold mb-6">Configurar Imagens</h1>
            <p class="text-gray-700 mb-6 text-sm">As imagens são salvas localmente no seu navegador. Elas não são enviadas para a internet.</p>
            
            <div class="space-y-4 max-h-96 overflow-y-auto pr-2">
                <!-- Configuração do Logo -->
                <div class="flex items-center space-x-4">
                    <img id="logo-preview" src="https://placehold.co/100x40/eeeeee/999999?text=Logo" class="h-10 w-24 object-contain border rounded">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700">Logo Principal</label>
                        <input type="file" id="logo-input" accept="image/*" class="w-full text-gray-700"
                               onchange="handleFileUpload(event, 'quizLogo', 'logo-preview')">
                    </div>
                </div>

                <!-- Configuração das Perguntas (Dinâmico) -->
                <div id="config-questions-list" class="space-y-4">
                    <!-- Inputs das perguntas serão gerados pelo JS -->
                </div>
            </div>

            <button id="back-to-start-button" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition-colors duration-200 mt-8">
                Voltar ao Início
            </button>
        </div>


        <!-- 2. Visão do Quiz (Atualizada) -->
        <div id="quiz-view" class="hidden-view">
            <!-- Logo Carregado -->
            <img id="logo-display" src="https://placehold.co/200x60/5f356d/ffffff?text=FAB+LAB+LOGO&font=inter" alt="Logo Fab Lab" class="mx-auto mb-8 h-12">

            <!-- Imagem da Pergunta -->
            <img id="question-image" src="" alt="Ilustração da Pergunta" class="w-full h-48 object-cover rounded-lg mb-6 hidden-view">

            <!-- Pergunta Atual -->
            <h2 id="question-text" class="font-title text-2xl font-semibold mb-6 min-h-[50px]">
                Carregando pergunta...
            </h2>

            <!-- Botões de Resposta -->
            <div id="answer-buttons" class="space-y-4">
                <!-- Botões serão gerados pelo JavaScript -->
            </div>

            <!-- Botão de Navegação (Voltar) -->
            <div class="flex justify-between mt-10">
                <button id="prev-button" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                    Voltar
                </button>
            </div>
        </div>

        <!-- 3. Visão de Resultado (Atualizada) -->
        <div id="result-view" class="hidden-view text-center">
            
            <h1 class="font-title text-3xl font-bold mb-3" id="result-title">
                <!-- Título do Resultado -->
            </h1>
            <p class="font-title text-xl font-semibold mb-6" id="result-focus">
                <!-- Foco do Resultado -->
            </p>
            <p class="text-base mb-8 text-gray-700" id="result-description">
                <!-- Descrição do Resultado -->
            </p>

            <button id="restart-button" class="w-full bg-[#ff3333] hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 mt-6 font-title text-lg">
                Fazer o Quiz Novamente
            </button>
        </div>
    </div>

    <!-- JavaScript - Lógica do Quiz -->
    <script>
        // --- 1. Dados do Quiz ---

        // Definição das Perguntas (COM IMAGENS)
        const questions = [
            {
                question: "O fio do seu carregador de celular quebrou bem na ponta. Qual sua primeira reação?",
                image: "https://placehold.co/600x400/f28020/ffffff?text=Gambiarra", // Placeholder
                answers: [
                    { text: "Pesquiso 'por que fios de carregador quebram?' para evitar que aconteça de novo.", profile: "inspiracao" },
                    { text: "Penso: 'E se eu inventasse um carregador sem fio que usa energia solar?'", profile: "ideacao" },
                    { text: "Pego fita isolante, um arame e tento fazer uma 'gambiarra' para funcionar só hoje.", profile: "prototipacao" },
                    { text: "Mando foto no grupo dos amigos/família perguntando quem tem um sobrando para me emprestar.", profile: "compartilhamento" }
                ]
            },
            {
                question: "Num trabalho em grupo (escola ou faculdade), quem é você?",
                image: "https://placehold.co/600x400/a0cfc6/ffffff?text=Trabalho+em+Grupo", // Placeholder
                answers: [
                    { text: "O que faz as perguntas difíceis e garante que o grupo está respondendo ao tema certo.", profile: "inspiracao" },
                    { text: "O que tem a ideia 'diferentona' para a apresentação (ex: fazer um vídeo, um teatro).", profile: "ideacao" },
                    { text: "O que abre o Canva ou o Google Slides e começa a montar o layout e organizar o conteúdo.", profile: "prototipacao" },
                    { text: "O que divide as tarefas, cobra os prazos e se oferece para apresentar o trabalho.", profile: "compartilhamento" }
                ]
            },
            {
                question: "Você vê um problema crônico na sua rua ou bairro (ex: lixo acumulado, falta de sinalização). O que você pensa?",
                image: "https://placehold.co/600x400/90851c/ffffff?text=Problema+Urbano", // Placeholder
                answers: [
                    { text: "Fico observando. Em que horários acontece? Quem são as pessoas envolvidas? Qual a raiz disso?", profile: "inspiracao" },
                    { text: "Imagino 10 soluções: um app de denúncia, um robô-gari, uma intervenção artística...", profile: "ideacao" },
                    { text: "Penso numa solução prática e direta: 'E se a gente mesmo pintasse uma faixa ou colocasse um cesto maior?'", profile: "prototipacao" },
                    { text: "Vou falar com a associação de moradores. Precisamos nos organizar e cobrar uma solução.", profile: "compartilhamento" }
                ]
            },
            {
                question: "Qual destas frases mais te descreve no dia-a-dia?",
                image: "https://placehold.co/600x400/ff3333/ffffff?text=Personalidade", // Placeholder
                answers: [
                    { text: "Eu preciso entender o 'porquê' das coisas antes de agir.", profile: "inspiracao" },
                    { text: "E se a gente fizesse de um jeito *totalmente* diferente?", profile: "ideacao" },
                    { text: "Feito é melhor que perfeito. Vamos testar logo.", profile: "prototipacao" },
                    { text: "Sozinho a gente vai rápido, mas junto a gente vai mais longe.", profile: "compartilhamento" }
                ]
            },
            {
                question: "Você precisa de um suporte para seu celular para gravar um vídeo, mas não tem um. O que você faz?",
                image: "https://placehold.co/600x400/5f356d/ffffff?text=Suporte+Caseiro", // Placeholder
                answers: [
                    { text: "Pesquiso 10 tutoriais de 'suporte de celular caseiro' no YouTube antes de decidir o melhor.", profile: "inspiracao" },
                    { text: "Penso: 'Posso usar um copo? Ou prender com um pregador? Ou amarrar com um barbante?'", profile: "ideacao" },
                    { text: "Pego dois copos, uma pilha de livros e fita adesiva e monto um 'tripé' que funciona.", profile: "prototipacao" },
                    { text: "Peço para um amigo ou familiar segurar o celular para mim enquanto eu gravo.", profile: "compartilhamento" }
                ]
            },
            {
                question: "Pense na cidade de Brasília, palco da nossa maratona. O que mais te fascina nela?",
                image: "https://placehold.co/600x400/1a1c31/ffffff?text=Brasília", // Placeholder
                answers: [
                    { text: "A história e as motivações políticas de JK para criar uma capital no interior.", profile: "inspiracao" },
                    { text: "A utopia de Niemeyer e Lúcio Costa. A 'loucura' de desenhar uma cidade-avião do zero.", profile: "ideacao" },
                    { text: "A engenharia. O desafio de *erguer* aqueles prédios (Catedral, Congresso) com a tecnologia da época.", profile: "prototipacao" },
                    { text: "O movimento dos 'Candangos'. A mistura de pessoas de todo o Brasil que *construíram* a cidade juntas.", profile: "compartilhamento" }
                ]
            },
            {
                question: "O que mais te incomoda e te move a agir?",
                image: "https://placehold.co/600x400/f28020/ffffff?text=Motivação", // Placeholder
                answers: [
                    { text: "Injustiça ou decisões tomadas sem entender o problema real das pessoas.", profile: "inspiracao" },
                    { text: "Rotina, tédio e fazer as coisas 'só porque sempre foi assim'.", profile: "ideacao" },
                    { text: "Ineficiência. Coisas quebradas, lentas ou malfeitas que ninguém se dispõe a consertar.", profile: "prototipacao" },
                    { text: "Desorganização, falta de comunicação e quando as pessoas não colaboram umas com as outras.", profile: "compartilhamento" }
                ]
            },
            {
                question: "Você tem um sábado livre e R$ 50 no bolso. Qual o rolê mais provável?",
                image: "https://placehold.co/600x400/a0cfc6/ffffff?text=Sábado+Livre", // Placeholder
                answers: [
                    { text: "Ir a um museu, uma livraria ou visitar um bairro histórico que eu não conheço.", profile: "inspiracao" },
                    { text: "Ir a uma loja de artesanato ou papelaria comprar materiais para um projeto criativo.", profile: "ideacao" },
                    { text: "Ir a uma loja de ferramentas comprar algo para consertar ou 'tunar' minha bicicleta/skate/PC.", profile: "prototipacao" },
                    { text: "Juntar com os amigos para um piquenique no parque ou organizar um encontro em casa.", profile: "compartilhamento" }
                ]
            }
        ];

        // Definição dos Perfis de Resultado (Mantendo cores para diferenciar)
        const resultsData = {
            inspiracao: {
                title: "O Explorador Empático",
                focus: "Foco em Sentir e Observar",
                description: "Você é a base do projeto! Seu superpoder é a curiosidade e a escuta ativa. Você adora investigar os 'porquês', entender as pessoas e definir o problema real antes de agir. (Alinhado ao Ato 1: 'EU')",
                colorClass: "text-[#5f356d]" // Roxo
            },
            ideacao: {
                title: "O Visionário Criativo",
                focus: "Foco em Imaginar e Criar",
                description: "Você é a chama da inovação! Seu superpoder é 'imaginar futuros desejáveis'. Você pensa fora da caixa, gera múltiplas alternativas e não tem medo de ideias radicais. (Alinhado ao 'Design de Futuros')",
                colorClass: "text-[#f28020]" // Laranja (da paleta anterior, para diferenciar)
            },
            prototipacao: {
                title: "O Construtor Mão na Massa",
                focus: "Foco em Construir e Prototipar",
                description: "Você é o motor da realização! Seu superpoder é transformar ideias em ação. Você adora 'aprender fazendo', testar materiais e usar ferramentas (como no Sesi Lab) para tornar o futuro palpável. (Alinhado ao Ato 3: 'EU E O MUNDO')",
                colorClass: "text-[#90851c]" // Oliva (da paleta anterior, para diferenciar)
            },
            compartilhamento: {
                title: "O Conector Colaborativo",
                focus: "Foco em Compartilhar e Mobilizar",
                description: "Você é a voz do time! Seu superpoder é a empatia e o 'protagonismo juvenil'. Você une o grupo, garante que todos sejam ouvidos e sabe como comunicar uma ideia para engajar a comunidade. (Alinhao ao Ato 2: 'EU E O OUTRO')",
                colorClass: "text-[#ff3333]" // Vermelho
            }
        };
 
        // --- 2. Lógica Principal do Quiz ---

        // Referências aos elementos do HTML
        const startView = document.getElementById('start-view');
        const configView = document.getElementById('config-view');
        const quizView = document.getElementById('quiz-view');
        const resultView = document.getElementById('result-view');
        
        const questionText = document.getElementById('question-text');
        const answerButtons = document.getElementById('answer-buttons');
        const questionImage = document.getElementById('question-image'); // Imagem da pergunta
        const prevButton = document.getElementById('prev-button'); // Botão Voltar

        const resultTitle = document.getElementById('result-title');
        const resultFocus = document.getElementById('result-focus');
        const resultDescription = document.getElementById('result-description');
        
        // Botões de Navegação
        const startQuizButton = document.getElementById('start-quiz-button');
        const configButton = document.getElementById('config-button');
        const backToStartButton = document.getElementById('back-to-start-button');
        const restartButton = document.getElementById('restart-button');
        
        // Elementos de Configuração
        const configQuestionsList = document.getElementById('config-questions-list');
        const logoDisplay = document.getElementById('logo-display');
        const logoStart = document.getElementById('logo-start');

        // Variáveis de estado do Quiz
        let currentQuestionIndex = 0;
        let scores = {
            inspiracao: 0,
            ideacao: 0,
            prototipacao: 0,
            compartilhamento: 0
        };
        let answerHistory = []; // Para salvar o histórico de respostas

        // --- 3. Funções de Navegação e Configuração ---

        // Converte arquivo para Base64 e salva no localStorage
        function handleFileUpload(event, storageKey, previewId) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64String = e.target.result;
                try {
                    localStorage.setItem(storageKey, base64String);
                    if (previewId) {
                        document.getElementById(previewId).src = base64String;
                    }
                    // Atualiza o logo na tela inicial instantaneamente
                    if (storageKey === 'quizLogo') {
                        logoStart.src = base64String;
                    }
                } catch (err) {
                    console.error("Erro ao salvar no localStorage (limite pode ter sido excedido):", err);
                    alert("Erro ao salvar imagem. O armazenamento local pode estar cheio.");
                }
            };
            reader.readAsDataURL(file);
        }

        // Carrega pré-visualizações na tela de configuração
        function loadConfigPreviews() {
            // Carrega Logo
            const savedLogo = localStorage.getItem('quizLogo');
            if (savedLogo) {
                document.getElementById('logo-preview').src = savedLogo;
                logoStart.src = savedLogo; // Atualiza logo da tela inicial
                logoDisplay.src = savedLogo; // Atualiza logo do quiz
            }

            // Gera e carrega inputs das perguntas
            configQuestionsList.innerHTML = ''; // Limpa lista antiga
            questions.forEach((q, index) => {
                const storageKey = `quizImage_q${index + 1}`;
                const previewId = `q${index + 1}-preview`;
                const savedImage = localStorage.getItem(storageKey);

                const item = document.createElement('div');
                item.className = 'flex items-center space-x-4 border-t pt-4';
                item.innerHTML = `
                    <img id="${previewId}" src="${savedImage || q.image}" class="h-10 w-24 object-contain border rounded">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700">Pergunta ${index + 1}</label>
                        <input type="file" id="q${index + 1}-input" accept="image/*" class="w-full text-gray-700"
                               onchange="handleFileUpload(event, '${storageKey}', '${previewId}')">
                    </div>
                `;
                configQuestionsList.appendChild(item);
            });
        }

        // Funções de troca de tela
        function showStartView() {
            startView.classList.remove('hidden-view');
            configView.classList.add('hidden-view');
            quizView.classList.add('hidden-view');
            resultView.classList.add('hidden-view');
            // Recarrega o logo principal
            const savedLogo = localStorage.getItem('quizLogo');
            if (savedLogo) logoStart.src = savedLogo;
        }

        function showConfigView() {
            startView.classList.add('hidden-view');
            configView.classList.remove('hidden-view');
            quizView.classList.add('hidden-view');
            resultView.classList.add('hidden-view');
            loadConfigPreviews(); // Carrega as imagens salvas
        }

        // --- 4. Lógica do Quiz ---

        // Função para iniciar ou reiniciar o quiz
        function startQuiz() {
            currentQuestionIndex = 0;
            scores = { inspiracao: 0, ideacao: 0, prototipacao: 0, compartilhamento: 0 };
            answerHistory = [];
            
            startView.classList.add('hidden-view');
            resultView.classList.add('hidden-view');
            quizView.classList.remove('hidden-view');

            // Carrega o logo no quiz
            const savedLogo = localStorage.getItem('quizLogo');
            if (savedLogo) logoDisplay.src = savedLogo;
            
            showQuestion();
        }

        // Função para mostrar a pergunta atual
        function showQuestion() {
            // Limpa botões antigos
            answerButtons.innerHTML = '';
            
            // Pega a pergunta atual
            const question = questions[currentQuestionIndex];
            questionText.innerHTML = question.question;

            // Mostra ou esconde a imagem da pergunta
            const storageKey = `quizImage_q${currentQuestionIndex + 1}`;
            const savedImage = localStorage.getItem(storageKey);
            const imageUrl = savedImage || question.image;

            if (imageUrl) {
                questionImage.src = imageUrl;
                questionImage.classList.remove('hidden-view');
            } else {
                questionImage.classList.add('hidden-view');
            }

            // Cria os botões de resposta
            question.answers.forEach(answer => {
                const button = document.createElement('button');
                button.innerHTML = answer.text;
                button.classList.add(
                    'w-full', 'bg-gray-100', 'hover:bg-[#ff3333]', 'hover:text-white', 
                    'text-gray-800', 'font-medium', 'py-3', 'px-5', 'rounded-lg', 
                    'transition-colors', 'duration-200', 'text-left', 'border', 'border-gray-200'
                );
                
                // Adiciona o evento de clique
                button.addEventListener('click', () => selectAnswer(answer.profile));
                answerButtons.appendChild(button);
            });

            // Atualiza o estado do botão "Voltar"
            updatePrevButtonState();
        }

        // Função chamada ao selecionar uma resposta
        function selectAnswer(profile) {
            scores[profile]++;
            answerHistory.push(profile); // Salva a resposta
            currentQuestionIndex++;

            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                showResult();
            }
        }

        // Função para voltar à pergunta anterior
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                
                // Remove a última resposta da pontuação
                const lastAnswerProfile = answerHistory.pop();
                if (lastAnswerProfile) {
                    scores[lastAnswerProfile]--;
                }
                
                showQuestion();
            }
        }

        // Função para habilitar/desabilitar o botão "Voltar"
        function updatePrevButtonState() {
            if (currentQuestionIndex === 0) {
                prevButton.disabled = true;
                prevButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                prevButton.disabled = false;
                prevButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Função para calcular e mostrar o resultado
        function showResult() {
            // Encontra o perfil com maior pontuação
            let maxScore = -1;
            let resultProfile = '';

            for (const profile in scores) {
                if (scores[profile] > maxScore) {
                    maxScore = scores[profile];
                    resultProfile = profile;
                }
            }

            // Pega os dados do perfil vencedor
            const result = resultsData[resultProfile];

            // Atualiza o HTML da visão de resultado
            resultTitle.innerText = result.title;
            resultFocus.innerText = result.focus;
            resultDescription.innerText = result.description;
            
            // Remove classes de cor antigas e adiciona a nova
            resultFocus.className = 'font-title text-xl font-semibold mb-6'; // Reseta
            resultFocus.classList.add(result.colorClass);

            // Esconde o quiz e mostra o resultado
            quizView.classList.add('hidden-view');
            resultView.classList.remove('hidden-view');
        }

        // --- 5. Inicialização ---

        // Adiciona o evento de clique nos botões de navegação
        startQuizButton.addEventListener('click', startQuiz);
        configButton.addEventListener('click', showConfigView);
        backToStartButton.addEventListener('click', showStartView);
        restartButton.addEventListener('click', showStartView); // Reinicia voltando ao Início
        prevButton.addEventListener('click', previousQuestion);

        // Inicia o quiz assim que a página carrega
        document.addEventListener('DOMContentLoaded', showStartView);

    </script>
</body>
</html>